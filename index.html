<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee - Èü≥Â£∞ÈÖç‰ø°„Ç¢„Éó„É™</title>
    <meta name="description" content="Coffee„ÅØÈü≥Â£∞ÈÖç‰ø°„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„Åß„Åô„ÄÇ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÁï™ÁµÑ„ÇíËÅ¥„ÅÑ„Åü„Çä„ÄÅËá™ÂàÜ„ÅßÈÖç‰ø°„Åó„Åü„Çä„Åß„Åç„Åæ„Åô„ÄÇ">
    <meta name="keywords" content="Èü≥Â£∞ÈÖç‰ø°, „Éù„ÉÉ„Éâ„Ç≠„É£„Çπ„Éà, „É©„Ç∏„Ç™, Èü≥Â£∞„É°„Éá„Ç£„Ç¢">
    <meta name="author" content="Coffee Team">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚òï</text></svg>">

    <!-- Daily.co SDK -->
    <script src="https://unpkg.com/@daily-co/daily-js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        coffee: {
                            50: '#fdf8f0',
                            100: '#fbeee0',
                            200: '#f6d6b3',
                            300: '#f0c185',
                            400: '#e8a852',
                            500: '#d2691e',
                            600: '#b8651e',
                            700: '#9e5a1a',
                            800: '#844e16',
                            900: '#6a4113',
                            950: '#3d1f07'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse-recording {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .recording-pulse {
            animation: pulse-recording 1s ease-in-out infinite;
        }
        .wave-animation {
            animation: wave 2s ease-in-out infinite;
        }
        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }
        .volume-bar {
            width: 100%;
            height: 4px;
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        .volume-indicator {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            border-radius: 2px;
            transition: width 0.1s ease;
        }
    </style>
</head>
<body class="min-h-screen transition-colors duration-300">
    <div id="app" class="max-w-md mx-auto min-h-screen relative"></div>

    <script>
        // Daily.coÈü≥Â£∞ÈÖç‰ø°„ÇØ„É©„Çπ - ‰øÆÊ≠£Áâà
        class DailyAudioStreamer {
            constructor() {
                this.callFrame = null;
                this.isHost = false;
                this.roomUrl = null;
                this.participants = new Map();
                this.isConnected = false;
                this.localAudio = true;
                this.roomName = null;
                this.listeners = [];
                
                // Daily.coË®≠ÂÆö
                this.dailyConfig = {
                    url: null,
                    showLeaveButton: false,
                    showFullscreenButton: false,
                    showLocalVideo: false,
                    showParticipantsBar: false,
                    activeSpeakerMode: true,
                    receiveSettings: {
                        video: false, // Èü≥Â£∞„ÅÆ„Åø
                        screenVideo: false
                    },
                    sendSettings: {
                        video: false, // Èü≥Â£∞„ÅÆ„Åø
                        screenVideo: false
                    }
                };
            }

            // Daily.coÂàùÊúüÂåñ
            async initialize() {
                try {
                    // Daily.co SDK„ÅÆË™≠„ÅøËæº„ÅøÁ¢∫Ë™ç
                    if (typeof DailyIframe === 'undefined') {
                        throw new Error('Daily.co SDK not loaded');
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Daily.coÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                    return false;
                }
            }

            // ÈÖç‰ø°„É´„Éº„É†‰ΩúÊàêÔºà„Éõ„Çπ„ÉàÁî®Ôºâ
            async createRoom(roomName, hostName) {
                try {
                    // „ÉÜ„Çπ„ÉàÁî®„ÅÆ„É´„Éº„É†‰ΩúÊàêÔºàÂÆüÈöõ„ÅÆAPI„Ç≠„Éº„ÅåÂøÖË¶ÅÔºâ
                    const roomUrl = `https://manus-test.daily.co/${roomName}`;
                    
                    this.roomUrl = roomUrl;
                    this.roomName = roomName;
                    this.isHost = true;
                    
                    // CallFrame‰ΩúÊàê
                    this.callFrame = DailyIframe.createFrame({
                        iframeStyle: {
                            position: 'fixed',
                            top: '-1000px',
                            left: '-1000px',
                            width: '1px',
                            height: '1px',
                            visibility: 'hidden'
                        },
                        ...this.dailyConfig,
                        url: roomUrl
                    });

                    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
                    this.setupEventListeners();

                    // „É´„Éº„É†ÂèÇÂä†
                    await this.callFrame.join({
                        userName: hostName,
                        startAudioOff: false,
                        startVideoOff: true
                    });

                    this.isConnected = true;
                    
                    return {
                        success: true,
                        roomUrl: roomUrl,
                        roomName: roomName
                    };
                    
                } catch (error) {
                    console.error('„É´„Éº„É†‰ΩúÊàê„Ç®„É©„Éº:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }

            // ÈÖç‰ø°„É´„Éº„É†ÂèÇÂä†Ôºà„É™„Çπ„Éä„ÉºÁî®Ôºâ
            async joinRoom(roomUrl, listenerName) {
                try {
                    this.roomUrl = roomUrl;
                    this.isHost = false;
                    
                    // CallFrame‰ΩúÊàê
                    this.callFrame = DailyIframe.createFrame({
                        iframeStyle: {
                            position: 'fixed',
                            top: '-1000px',
                            left: '-1000px',
                            width: '1px',
                            height: '1px',
                            visibility: 'hidden'
                        },
                        ...this.dailyConfig,
                        url: roomUrl
                    });

                    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
                    this.setupEventListeners();

                    // „É´„Éº„É†ÂèÇÂä†Ôºà„É™„Çπ„Éä„Éº„ÅØÈü≥Â£∞ÈÄÅ‰ø°„Ç™„ÉïÔºâ
                    await this.callFrame.join({
                        userName: listenerName,
                        startAudioOff: true, // „É™„Çπ„Éä„Éº„ÅØ„Éü„É•„Éº„Éà
                        startVideoOff: true
                    });

                    this.isConnected = true;
                    
                    return {
                        success: true,
                        roomUrl: roomUrl
                    };
                    
                } catch (error) {
                    console.error('„É´„Éº„É†ÂèÇÂä†„Ç®„É©„Éº:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            setupEventListeners() {
                if (!this.callFrame) return;

                // ÂèÇÂä†ËÄÖ„ÅÆÂèÇÂä†
                this.callFrame.on('participant-joined', (event) => {
                    const participant = event.participant;
                    this.participants.set(participant.session_id, participant);
                    this.notifyListeners('participant-joined', participant);
                });

                // ÂèÇÂä†ËÄÖ„ÅÆÈÄÄÂá∫
                this.callFrame.on('participant-left', (event) => {
                    const participant = event.participant;
                    this.participants.delete(participant.session_id);
                    this.notifyListeners('participant-left', participant);
                });

                // Èü≥Â£∞Áä∂ÊÖãÂ§âÊõ¥
                this.callFrame.on('participant-updated', (event) => {
                    const participant = event.participant;
                    this.participants.set(participant.session_id, participant);
                    this.notifyListeners('participant-updated', participant);
                });

                // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
                this.callFrame.on('error', (event) => {
                    console.error('Daily.co „Ç®„É©„Éº:', event);
                    this.notifyListeners('error', event);
                });

                // Êé•Á∂öÁä∂ÊÖãÂ§âÊõ¥
                this.callFrame.on('joined-meeting', (event) => {
                    this.notifyListeners('joined', event);
                });

                this.callFrame.on('left-meeting', (event) => {
                    this.isConnected = false;
                    this.notifyListeners('left', event);
                });
            }

            // Èü≥Â£∞„ÅÆ„Ç™„É≥/„Ç™„ÉïÂàá„ÇäÊõø„Åà
            async toggleAudio() {
                if (!this.callFrame || !this.isConnected) return false;

                try {
                    this.localAudio = !this.localAudio;
                    await this.callFrame.setLocalAudio(this.localAudio);
                    return this.localAudio;
                } catch (error) {
                    console.error('Èü≥Â£∞Âàá„ÇäÊõø„Åà„Ç®„É©„Éº:', error);
                    return false;
                }
            }

            // ÂèÇÂä†ËÄÖÊï∞ÂèñÂæó
            getParticipantCount() {
                return this.participants.size;
            }

            // ÂèÇÂä†ËÄÖ„É™„Çπ„ÉàÂèñÂæó
            getParticipants() {
                return Array.from(this.participants.values());
            }

            // „É´„Éº„É†ÈÄÄÂá∫
            async leaveRoom() {
                try {
                    if (this.callFrame && this.isConnected) {
                        await this.callFrame.leave();
                    }
                    
                    if (this.callFrame) {
                        this.callFrame.destroy();
                        this.callFrame = null;
                    }
                    
                    this.isConnected = false;
                    this.participants.clear();
                    this.roomUrl = null;
                    this.roomName = null;
                    
                    return true;
                } catch (error) {
                    console.error('„É´„Éº„É†ÈÄÄÂá∫„Ç®„É©„Éº:', error);
                    return false;
                }
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºËøΩÂä†
            addEventListener(callback) {
                this.listeners.push(callback);
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÂâäÈô§
            removeEventListener(callback) {
                const index = this.listeners.indexOf(callback);
                if (index > -1) {
                    this.listeners.splice(index, 1);
                }
            }

            // „É™„Çπ„Éä„Éº„Å´ÈÄöÁü•
            notifyListeners(eventType, data) {
                this.listeners.forEach(callback => {
                    try {
                        callback(eventType, data);
                    } catch (error) {
                        console.error('„É™„Çπ„Éä„ÉºÈÄöÁü•„Ç®„É©„Éº:', error);
                    }
                });
            }

            // „É´„Éº„É†URLÁîüÊàê
            static generateRoomUrl(roomName) {
                return `https://manus-test.daily.co/${roomName}`;
            }

            // „É´„Éº„É†Âêç„Åã„ÇâURLÊäΩÂá∫
            static extractRoomName(roomUrl) {
                try {
                    const url = new URL(roomUrl);
                    return url.pathname.substring(1); // '/'„ÇíÈô§Âéª
                } catch (error) {
                    return null;
                }
            }
        }

        // „É´„Éº„É†ÁÆ°ÁêÜ„ÇØ„É©„Çπ
        class RoomManager {
            constructor() {
                this.activeRooms = new Map();
                this.currentRoom = null;
            }

            // „É©„É≥„ÉÄ„É†„É´„Éº„É†ÂêçÁîüÊàê
            generateRoomName() {
                const adjectives = ['cozy', 'warm', 'bright', 'calm', 'fresh'];
                const nouns = ['coffee', 'chat', 'talk', 'voice', 'sound'];
                const randomNum = Math.floor(Math.random() * 1000);
                
                const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
                const noun = nouns[Math.floor(Math.random() * nouns.length)];
                
                return `${adjective}-${noun}-${randomNum}`;
            }

            // „É´„Éº„É†‰ΩúÊàê
            async createRoom(hostName, roomTitle = '') {
                const roomName = this.generateRoomName();
                const streamer = new DailyAudioStreamer();
                
                const result = await streamer.createRoom(roomName, hostName);
                
                if (result.success) {
                    const roomInfo = {
                        name: roomName,
                        title: roomTitle || `${hostName}„ÅÆÈÖç‰ø°`,
                        host: hostName,
                        streamer: streamer,
                        createdAt: new Date(),
                        participants: 0
                    };
                    
                    this.activeRooms.set(roomName, roomInfo);
                    this.currentRoom = roomInfo;
                    
                    // ÂèÇÂä†ËÄÖÊï∞Êõ¥Êñ∞„ÅÆ„É™„Çπ„Éä„ÉºË®≠ÂÆö
                    streamer.addEventListener((eventType, data) => {
                        if (eventType === 'participant-joined' || eventType === 'participant-left') {
                            roomInfo.participants = streamer.getParticipantCount();
                        }
                    });
                }
                
                return result;
            }

            // „É´„Éº„É†ÂèÇÂä†
            async joinRoom(roomUrl, listenerName) {
                const roomName = DailyAudioStreamer.extractRoomName(roomUrl);
                if (!roomName) {
                    return { success: false, error: 'ÁÑ°Âäπ„Å™„É´„Éº„É†URL„Åß„Åô' };
                }

                const streamer = new DailyAudioStreamer();
                const result = await streamer.joinRoom(roomUrl, listenerName);
                
                if (result.success) {
                    const roomInfo = {
                        name: roomName,
                        streamer: streamer,
                        joinedAt: new Date(),
                        isListener: true
                    };
                    
                    this.currentRoom = roomInfo;
                }
                
                return result;
            }

            // ÁèæÂú®„ÅÆ„É´„Éº„É†ÂèñÂæó
            getCurrentRoom() {
                return this.currentRoom;
            }

            // „É´„Éº„É†ÈÄÄÂá∫
            async leaveCurrentRoom() {
                if (this.currentRoom && this.currentRoom.streamer) {
                    await this.currentRoom.streamer.leaveRoom();
                    
                    if (!this.currentRoom.isListener) {
                        this.activeRooms.delete(this.currentRoom.name);
                    }
                    
                    this.currentRoom = null;
                    return true;
                }
                return false;
            }

            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É´„Éº„É†‰∏ÄË¶ß
            getActiveRooms() {
                return Array.from(this.activeRooms.values());
            }
        }

        // Èü≥Â£∞Èå≤Èü≥„ÇØ„É©„ÇπÔºàÊó¢Â≠òÔºâ
        class AudioRecorder {
            constructor() {
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.stream = null;
                this.analyser = null;
                this.audioContext = null;
                this.volumeCallback = null;
                this.animationFrameId = null;
            }

            async init() {
                try {
                    this.stream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true,
                            sampleRate: 44100
                        }
                    });

                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioContext.createAnalyser();
                    const source = this.audioContext.createMediaStreamSource(this.stream);
                    source.connect(this.analyser);
                    this.analyser.fftSize = 256;

                    this.mediaRecorder = new MediaRecorder(this.stream, {
                        mimeType: 'audio/webm;codecs=opus'
                    });

                    this.mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            this.audioChunks.push(event.data);
                        }
                    };

                    return true;
                } catch (error) {
                    console.error('„Éû„Ç§„ÇØ„Ç¢„ÇØ„Çª„Çπ„Ç®„É©„Éº:', error);
                    return false;
                }
            }

            startRecording(onVolumeUpdate) {
                if (!this.mediaRecorder || this.mediaRecorder.state === 'recording') return false;

                this.audioChunks = [];
                this.volumeCallback = onVolumeUpdate;
                this.mediaRecorder.start(100);
                this.startVolumeMonitoring();
                return true;
            }

            async stopRecording() {
                if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
                    this.mediaRecorder.stop();
                    this.stopVolumeMonitoring();
                    return new Promise((resolve) => {
                        this.mediaRecorder.onstop = () => {
                            const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                            this.stream.getTracks().forEach(track => track.stop());
                            if (this.audioContext) {
                                this.audioContext.close();
                                this.audioContext = null;
                                this.analyser = null;
                            }
                            this.stream = null;
                            this.mediaRecorder = null;
                            resolve(audioBlob);
                        };
                    });
                }
                return null;
            }

            startVolumeMonitoring() {
                if (!this.analyser) return;

                const dataArray = new Uint8Array(this.analyser.frequencyBinCount);

                const updateVolume = () => {
                    if (!this.volumeCallback || !AppState.isRecording) {
                        cancelAnimationFrame(this.animationFrameId);
                        this.animationFrameId = null;
                        return;
                    }

                    this.analyser.getByteFrequencyData(dataArray);
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    const volumeLevel = (average / 255) * 100;

                    this.volumeCallback(volumeLevel);

                    this.animationFrameId = requestAnimationFrame(updateVolume);
                };

                this.animationFrameId = requestAnimationFrame(updateVolume);
            }

            stopVolumeMonitoring() {
                if (this.animationFrameId) {
                    cancelAnimationFrame(this.animationFrameId);
                    this.animationFrameId = null;
                }
                this.volumeCallback = null;
            }

            cleanup() {
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                    this.analyser = null;
                }
                if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
                    this.mediaRecorder.stop();
                }
                this.stopVolumeMonitoring();
                this.audioChunks = [];
            }
        }

        // Èü≥Â£∞ÈÖç‰ø°„ÇØ„É©„ÇπÔºàÊó¢Â≠òÔºâ
        class AudioStreamer {
            constructor() {
                this.recordings = [];
            }

            async uploadRecording(audioBlob, metadata) {
                return new Promise((resolve) => {
                    const recording = {
                        id: Date.now(),
                        blob: audioBlob,
                        url: URL.createObjectURL(audioBlob),
                        ...metadata,
                        uploadedAt: new Date()
                    };

                    this.recordings.push(recording);

                    setTimeout(() => {
                        resolve({
                            success: true,
                            url: recording.url,
                            id: recording.id
                        });
                    }, 1000);
                });
            }

            getRecordings() {
                return this.recordings;
            }
        }

        // „Ç¢„Éó„É™„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
        const AppState = {
            currentTab: 'home',
            isPlaying: false,
            isRecording: false,
            currentShow: null,
            audioPlayer: new Audio(),
            searchQuery: '',
            recordingTime: 0,
            recordingTimer: null,
            isDarkMode: false,
            volumeLevel: 0,
            showRecordingForm: false,
            recordingTitle: '',
            recordingDescription: '',
            currentRecordingBlob: null,
            isUploading: false,
            
            // Daily.coÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã
            isStreaming: false,
            isListening: false,
            currentRoom: null,
            participantCount: 0,
            roomUrl: '',
            hostName: '',
            listenerName: '',
            showRoomForm: false,
            showJoinForm: false,
            roomTitle: '',
            streamingError: null,

            featuredShows: [
                {
                    id: 1,
                    title: "Êúù„ÅÆ„Ç≥„Éº„Éí„Éº„Éñ„É¨„Ç§„ÇØ",
                    host: "Áî∞‰∏≠„Åï„Åè„Çâ",
                    listeners: 1234,
                    duration: "12:34",
                    category: "„É©„Ç§„Éï„Çπ„Çø„Ç§„É´",
                    isLive: true,
                    avatar: "‚òï",
                    likes: 89,
                    comments: 23,
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
                },
                {
                    id: 2,
                    title: "Ê∑±Â§ú„ÅÆË™≠Êõ∏‰ºö",
                    host: "Â±±Áî∞Â§™ÈÉé",
                    listeners: 567,
                    duration: "25:16",
                    category: "Ë™≠Êõ∏",
                    isLive: false,
                    avatar: "üìö",
                    likes: 156,
                    comments: 34,
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
                },
                {
                    id: 3,
                    title: "‰ªäÊó•„ÅÆ„Éã„É•„Éº„ÇπËß£Ë™¨",
                    host: "‰ΩêËó§Ëä±Â≠ê",
                    listeners: 2345,
                    duration: "18:42",
                    category: "„Éã„É•„Éº„Çπ",
                    isLive: true,
                    avatar: "üì∞",
                    likes: 203,
                    comments: 67,
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
                },
                {
                    id: 4,
                    title: "Â§ú„ÅÆ„Ç∏„É£„Ç∫„Çø„Ç§„É†",
                    host: "Èà¥Êú®„Ç∏„É≠„Éº",
                    listeners: 890,
                    duration: "45:22",
                    category: "Èü≥Ê•Ω",
                    isLive: false,
                    avatar: "üé∑",
                    likes: 334,
                    comments: 12,
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3"
                },
                {
                    id: 5,
                    title: "„Åä„ÇÑ„Åô„ÅøÂâç„ÅÆ„Å≤„Å®„Å®„Åç",
                    host: "Â∞èÊûó„Å≤„Åã„Çã",
                    listeners: 432,
                    duration: "10:05",
                    category: "„Éà„Éº„ÇØ",
                    isLive: true,
                    avatar: "üåô",
                    likes: 102,
                    comments: 45,
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3"
                }
            ],

            categories: ["„Åô„Åπ„Å¶", "„É©„Ç§„Éï„Çπ„Çø„Ç§„É´", "Ë™≠Êõ∏", "„Éã„É•„Éº„Çπ", "Èü≥Ê•Ω", "„Éà„Éº„ÇØ", "Â≠¶Áøí", "„É¶„Éº„Ç∂„ÉºÊäïÁ®ø"]
        };

        // „Ç∞„É≠„Éº„Éê„É´„Ç§„É≥„Çπ„Çø„É≥„Çπ
        const audioRecorder = new AudioRecorder();
        const audioStreamer = new AudioStreamer();
        const roomManager = new RoomManager();
        let dailyStreamer = null;

        // Daily.coÁµ±ÂêàÁî®„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        async function startStreaming(hostName, roomTitle) {
            try {
                AppState.streamingError = null;
                
                const result = await roomManager.createRoom(hostName, roomTitle);
                
                if (result.success) {
                    AppState.isStreaming = true;
                    AppState.currentRoom = roomManager.getCurrentRoom();
                    AppState.roomUrl = result.roomUrl;
                    AppState.participantCount = 1;
                    
                    renderApp();
                    
                    return {
                        success: true,
                        roomUrl: result.roomUrl,
                        roomName: result.roomName
                    };
                } else {
                    AppState.streamingError = result.error;
                    renderApp();
                    return result;
                }
            } catch (error) {
                console.error('ÈÖç‰ø°ÈñãÂßã„Ç®„É©„Éº:', error);
                AppState.streamingError = error.message;
                renderApp();
                return { success: false, error: error.message };
            }
        }

        async function stopStreaming() {
            try {
                const success = await roomManager.leaveCurrentRoom();
                
                if (success) {
                    AppState.isStreaming = false;
                    AppState.currentRoom = null;
                    AppState.roomUrl = '';
                    AppState.participantCount = 0;
                    AppState.streamingError = null;
                    
                    renderApp();
                }
                
                return success;
            } catch (error) {
                console.error('ÈÖç‰ø°ÂÅúÊ≠¢„Ç®„É©„Éº:', error);
                AppState.streamingError = error.message;
                renderApp();
                return false;
            }
        }

        async function joinRoom(roomUrl, listenerName) {
            try {
                AppState.streamingError = null;
                
                const result = await roomManager.joinRoom(roomUrl, listenerName);
                
                if (result.success) {
                    AppState.isListening = true;
                    AppState.currentRoom = roomManager.getCurrentRoom();
                    AppState.roomUrl = roomUrl;
                    
                    const room = roomManager.getCurrentRoom();
                    if (room && room.streamer) {
                        room.streamer.addEventListener((eventType, data) => {
                            if (eventType === 'participant-joined' || eventType === 'participant-left') {
                                AppState.participantCount = room.streamer.getParticipantCount();
                                renderApp();
                            }
                        });
                    }
                    
                    renderApp();
                    
                    return result;
                } else {
                    AppState.streamingError = result.error;
                    renderApp();
                    return result;
                }
            } catch (error) {
                console.error('„É´„Éº„É†ÂèÇÂä†„Ç®„É©„Éº:', error);
                AppState.streamingError = error.message;
                renderApp();
                return { success: false, error: error.message };
            }
        }

        async function leaveRoom() {
            try {
                const success = await roomManager.leaveCurrentRoom();
                
                if (success) {
                    AppState.isListening = false;
                    AppState.currentRoom = null;
                    AppState.roomUrl = '';
                    AppState.participantCount = 0;
                    AppState.streamingError = null;
                    
                    renderApp();
                }
                
                return success;
            } catch (error) {
                console.error('„É´„Éº„É†ÈÄÄÂá∫„Ç®„É©„Éº:', error);
                AppState.streamingError = error.message;
                renderApp();
                return false;
            }
        }

        async function toggleStreamingAudio() {
            try {
                const room = roomManager.getCurrentRoom();
                if (room && room.streamer) {
                    const audioOn = await room.streamer.toggleAudio();
                    renderApp();
                    return audioOn;
                }
                return false;
            } catch (error) {
                console.error('Èü≥Â£∞Âàá„ÇäÊõø„Åà„Ç®„É©„Éº:', error);
                return false;
            }
        }

        function shareRoomUrl(roomUrl) {
            if (navigator.share) {
                navigator.share({
                    title: 'CoffeeÈÖç‰ø°„Å´ÂèÇÂä†',
                    text: '„É©„Ç§„ÉñÈÖç‰ø°„ÇíËÅû„ÅÑ„Å¶„Åø„Åæ„Åõ„Çì„ÅãÔºü',
                    url: roomUrl
                }).catch(console.error);
            } else {
                navigator.clipboard.writeText(roomUrl).then(() => {
                    alert('„É´„Éº„É†URL„Çí„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
                }).catch(() => {
                    prompt('„É´„Éº„É†URL„Çí„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', roomUrl);
                });
            }
        }

        function validateRoomUrl(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname.includes('daily.co') && urlObj.pathname.length > 1;
            } catch (error) {
                return false;
            }
        }

        function calculateStreamingDuration(startTime) {
            const now = new Date();
            const diff = now - startTime;
            const minutes = Math.floor(diff / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function getRoomDisplayInfo() {
            const room = roomManager.getCurrentRoom();
            if (!room) return null;
            
            return {
                name: room.name,
                title: room.title || '„É©„Ç§„ÉñÈÖç‰ø°',
                host: room.host || 'ÈÖç‰ø°ËÄÖ',
                participantCount: AppState.participantCount,
                isHost: AppState.isStreaming,
                isListener: AppState.isListening,
                duration: room.createdAt ? calculateStreamingDuration(room.createdAt) : '0:00'
            };
        }

        // „Ç¢„Ç§„Ç≥„É≥SVG„ÅÆÂÆöÁæ©
        const Icons = {
            Home: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11v11a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>',
            Plus: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>',
            User: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>',
            Play: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>',
            Pause: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
            Mic: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>',
            Search: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>',
            Heart: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>',
            MessageCircle: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>',
            Volume2: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M11 5L6 9H2v6h4l5 4V5z"/></svg>',
            Coffee: '<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-8a2 2 0 00-2 2v2m12 0H4m12 0l1.5 8.5a1.5 1.5 0 01-1.5 1.5H8a1.5 1.5 0 01-1.5-1.5L8 6m4 0V4m0 0h4m-4 0H8"/></svg>',
            Moon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>',
            Sun: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>'
        };

        // Daily.coÈÖç‰ø°UI „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà

        // ÈÖç‰ø°ÈñãÂßã„Éï„Ç©„Éº„É†
        function renderStreamingForm() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
                            „É©„Ç§„ÉñÈÖç‰ø°„ÇíÈñãÂßã
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    ÈÖç‰ø°ËÄÖÂêç
                                </label>
                                <input 
                                    type="text" 
                                    id="hostNameInput"
                                    value="${AppState.hostName}"
                                    placeholder="„ÅÇ„Å™„Åü„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ"
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                                >
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    ÈÖç‰ø°„Çø„Ç§„Éà„É´Ôºà‰ªªÊÑèÔºâ
                                </label>
                                <input 
                                    type="text" 
                                    id="roomTitleInput"
                                    value="${AppState.roomTitle}"
                                    placeholder="ÈÖç‰ø°„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ"
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                                >
                            </div>
                            
                            <div class="bg-coffee-50 dark:bg-coffee-900 p-3 rounded-md">
                                <p class="text-sm text-coffee-700 dark:text-coffee-300">
                                    üí° ÈÖç‰ø°„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅ‰ªñ„ÅÆ‰∫∫„Åå„ÅÇ„Å™„Åü„ÅÆÈü≥Â£∞„ÇíËÅû„Åè„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
                                </p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3 mt-6">
                            <button 
                                onclick="cancelStreamingForm()"
                                class="flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                            >
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                            <button 
                                onclick="handleStartStreaming()"
                                class="flex-1 px-4 py-2 bg-coffee-500 text-white rounded-md hover:bg-coffee-600 transition-colors"
                            >
                                ÈÖç‰ø°ÈñãÂßã
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // „É´„Éº„É†ÂèÇÂä†„Éï„Ç©„Éº„É†
        function renderJoinForm() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
                            ÈÖç‰ø°„Å´ÂèÇÂä†
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    „ÅÇ„Å™„Åü„ÅÆÂêçÂâç
                                </label>
                                <input 
                                    type="text" 
                                    id="listenerNameInput"
                                    value="${AppState.listenerName}"
                                    placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ"
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                                >
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    „É´„Éº„É†URL
                                </label>
                                <input 
                                    type="url" 
                                    id="roomUrlInput"
                                    value="${AppState.roomUrl}"
                                    placeholder="https://manus-test.daily.co/room-name"
                                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                                >
                            </div>
                            
                            <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-md">
                                <p class="text-sm text-blue-700 dark:text-blue-300">
                                    üéß „É™„Çπ„Éä„Éº„Å®„Åó„Å¶ÂèÇÂä†„Åó„Åæ„Åô„ÄÇÈü≥Â£∞„ÅØÈÄÅ‰ø°„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
                                </p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3 mt-6">
                            <button 
                                onclick="cancelJoinForm()"
                                class="flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                            >
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                            <button 
                                onclick="handleJoinRoom()"
                                class="flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"
                            >
                                ÂèÇÂä†
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÈÖç‰ø°‰∏≠„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
        function renderStreamingInterface() {
            const roomInfo = getRoomDisplayInfo();
            if (!roomInfo) return '';
            
            return `
                <div class="bg-gradient-to-r from-red-500 to-pink-500 text-white p-4 rounded-lg mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-white rounded-full recording-pulse"></div>
                            <span class="font-semibold">LIVEÈÖç‰ø°‰∏≠</span>
                        </div>
                        <div class="text-sm opacity-90">
                            ${roomInfo.duration}
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-lg mb-2">${roomInfo.title}</h3>
                    <p class="text-sm opacity-90 mb-3">ÈÖç‰ø°ËÄÖ: ${roomInfo.host}</p>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-1">
                                <span class="text-sm">üë•</span>
                                <span class="text-sm">${roomInfo.participantCount}‰∫∫</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button 
                                onclick="toggleStreamingAudio()"
                                class="p-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors"
                            >
                                ${Icons.Mic}
                            </button>
                            <button 
                                onclick="shareCurrentRoom()"
                                class="p-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors"
                            >
                                üì§
                            </button>
                            <button 
                                onclick="handleStopStreaming()"
                                class="px-4 py-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors text-sm"
                            >
                                ÈÖç‰ø°ÁµÇ‰∫Ü
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // „É™„Çπ„Éã„É≥„Ç∞‰∏≠„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
        function renderListeningInterface() {
            const roomInfo = getRoomDisplayInfo();
            if (!roomInfo) return '';
            
            return `
                <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-white rounded-full recording-pulse"></div>
                            <span class="font-semibold">ÈÖç‰ø°„ÇíËÅ¥Âèñ‰∏≠</span>
                        </div>
                        <div class="text-sm opacity-90">
                            ${roomInfo.duration}
                        </div>
                    </div>
                    
                    <h3 class="font-semibold text-lg mb-2">${roomInfo.title}</h3>
                    <p class="text-sm opacity-90 mb-3">ÈÖç‰ø°ËÄÖ: ${roomInfo.host}</p>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-1">
                                <span class="text-sm">üë•</span>
                                <span class="text-sm">${roomInfo.participantCount}‰∫∫</span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <span class="text-sm">üéß</span>
                                <span class="text-sm">„É™„Çπ„Éä„Éº</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button 
                                onclick="shareCurrentRoom()"
                                class="p-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors"
                            >
                                üì§
                            </button>
                            <button 
                                onclick="handleLeaveRoom()"
                                class="px-4 py-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors text-sm"
                            >
                                ÈÄÄÂá∫
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÈÖç‰ø°„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥
        function renderStreamingControls() {
            if (AppState.isStreaming || AppState.isListening) {
                return '';
            }
            
            return `
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <button 
                        onclick="showStreamingForm()"
                        class="flex flex-col items-center justify-center p-4 bg-gradient-to-r from-coffee-500 to-coffee-600 text-white rounded-lg hover:from-coffee-600 hover:to-coffee-700 transition-all transform hover:scale-105"
                    >
                        <div class="w-8 h-8 mb-2">
                            ${Icons.Mic}
                        </div>
                        <span class="text-sm font-medium">ÈÖç‰ø°ÈñãÂßã</span>
                    </button>
                    
                    <button 
                        onclick="showJoinForm()"
                        class="flex flex-col items-center justify-center p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105"
                    >
                        <div class="w-8 h-8 mb-2">
                            üéß
                        </div>
                        <span class="text-sm font-medium">ÈÖç‰ø°„Å´ÂèÇÂä†</span>
                    </button>
                </div>
            `;
        }

        // „Ç®„É©„ÉºË°®Á§∫
        function renderStreamingError() {
            if (!AppState.streamingError) return '';
            
            return `
                <div class="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4 mb-4">
                    <div class="flex items-center">
                        <div class="text-red-500 mr-3">‚ö†Ô∏è</div>
                        <div>
                            <h4 class="text-red-800 dark:text-red-200 font-medium">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</h4>
                            <p class="text-red-600 dark:text-red-300 text-sm mt-1">${AppState.streamingError}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÉºÈñ¢Êï∞
        function showStreamingForm() {
            AppState.showRoomForm = true;
            renderApp();
        }

        function cancelStreamingForm() {
            AppState.showRoomForm = false;
            renderApp();
        }

        function showJoinForm() {
            AppState.showJoinForm = true;
            renderApp();
        }

        function cancelJoinForm() {
            AppState.showJoinForm = false;
            renderApp();
        }

        async function handleStartStreaming() {
            const hostName = document.getElementById('hostNameInput').value.trim();
            const roomTitle = document.getElementById('roomTitleInput').value.trim();
            
            if (!hostName) {
                alert('ÈÖç‰ø°ËÄÖÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            AppState.hostName = hostName;
            AppState.roomTitle = roomTitle;
            AppState.showRoomForm = false;
            
            const result = await startStreaming(hostName, roomTitle);
            
            if (result.success) {
                console.log('ÈÖç‰ø°ÈñãÂßãÊàêÂäü:', result);
            } else {
                console.error('ÈÖç‰ø°ÈñãÂßãÂ§±Êïó:', result.error);
            }
        }

        async function handleJoinRoom() {
            const listenerName = document.getElementById('listenerNameInput').value.trim();
            const roomUrl = document.getElementById('roomUrlInput').value.trim();
            
            if (!listenerName) {
                alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!roomUrl || !validateRoomUrl(roomUrl)) {
                alert('ÊúâÂäπ„Å™„É´„Éº„É†URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            AppState.listenerName = listenerName;
            AppState.roomUrl = roomUrl;
            AppState.showJoinForm = false;
            
            const result = await joinRoom(roomUrl, listenerName);
            
            if (result.success) {
                console.log('„É´„Éº„É†ÂèÇÂä†ÊàêÂäü:', result);
            } else {
                console.error('„É´„Éº„É†ÂèÇÂä†Â§±Êïó:', result.error);
            }
        }

        async function handleStopStreaming() {
            if (confirm('ÈÖç‰ø°„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü')) {
                await stopStreaming();
            }
        }

        async function handleLeaveRoom() {
            if (confirm('ÈÖç‰ø°„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åô„ÅãÔºü')) {
                await leaveRoom();
            }
        }

        function shareCurrentRoom() {
            if (AppState.roomUrl) {
                shareRoomUrl(AppState.roomUrl);
            }
        }

        // „Çø„ÉñÂàá„ÇäÊõø„ÅàÊôÇ„ÅÆÈÖç‰ø°„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„ÇπÁµ±Âêà
        function renderStreamingTab() {
            return `
                <div class="p-4">
                    ${renderStreamingError()}
                    ${renderStreamingInterface()}
                    ${renderListeningInterface()}
                    ${renderStreamingControls()}
                    
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            „É©„Ç§„ÉñÈÖç‰ø°„Å´„Å§„ÅÑ„Å¶
                        </h3>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">ÈÖç‰ø°ËÄÖ„Å®„Åó„Å¶</h4>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                <li>‚Ä¢ „É™„Ç¢„É´„Çø„Ç§„É†„ÅßÈü≥Â£∞„ÇíÈÖç‰ø°„Åß„Åç„Åæ„Åô</li>
                                <li>‚Ä¢ ÂèÇÂä†ËÄÖÊï∞„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô</li>
                                <li>‚Ä¢ „É´„Éº„É†URL„ÇíÂÖ±Êúâ„Åó„Å¶ËÅ¥ÂèñËÄÖ„ÇíÊãõÂæÖ„Åß„Åç„Åæ„Åô</li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">„É™„Çπ„Éä„Éº„Å®„Åó„Å¶</h4>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                <li>‚Ä¢ „É´„Éº„É†URL„ÅßÈÖç‰ø°„Å´ÂèÇÂä†„Åß„Åç„Åæ„Åô</li>
                                <li>‚Ä¢ È´òÂìÅË≥™„Å™Èü≥Â£∞„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßËÅ¥Âèñ„Åß„Åç„Åæ„Åô</li>
                                <li>‚Ä¢ ‰ªñ„ÅÆÂèÇÂä†ËÄÖ„Å®‰∏ÄÁ∑í„Å´ÈÖç‰ø°„ÇíÊ•Ω„Åó„ÇÅ„Åæ„Åô</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // Êó¢Â≠ò„ÅÆUIÈñ¢Êï∞ÔºàÁúÅÁï•„Åï„Çå„Å¶„ÅÑ„ÇãÈÉ®ÂàÜ„ÅØÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„Çí‰ΩøÁî®Ôºâ
        // ... ‰ªñ„ÅÆUIÈñ¢Êï∞„ÅØÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„Åã„ÇâÁ∂ôÁ∂ö ...

        // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        window.addEventListener('beforeunload', async () => {
            if (AppState.isStreaming || AppState.isListening) {
                await roomManager.leaveCurrentRoom();
            }
        });

        // „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÁä∂ÊÖãÁõ£Ë¶ñ
        window.addEventListener('online', () => {
            console.log('Network online');
            if (AppState.streamingError && AppState.streamingError.includes('„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ')) {
                AppState.streamingError = null;
                renderApp();
            }
        });

        window.addEventListener('offline', () => {
            console.log('Network offline');
            AppState.streamingError = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü';
            renderApp();
        });

        // „Ç¢„Éó„É™ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('Daily.co ready');
                renderApp();
            } catch (error) {
                console.error('Daily.co initialization failed:', error);
            }
        });

        // ‰ª•‰∏ã„ÄÅÊó¢Â≠ò„ÅÆUIÈñ¢Êï∞„ÇíÁ∂ôÁ∂ö...
        // renderApp()Èñ¢Êï∞„Å™„Å©„ÅØÂÖÉ„ÅÆ„Ç≥„Éº„Éâ„Çí‰ΩøÁî®„Åó„ÄÅÈÖç‰ø°„Çø„Éñ„ÇíËøΩÂä†
        
    </script>
</body>
</html>

