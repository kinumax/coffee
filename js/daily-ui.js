// Daily.coÈÖç‰ø°UI „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà

// ÈÖç‰ø°ÈñãÂßã„Éï„Ç©„Éº„É†
function renderStreamingForm() {
    return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
                    „É©„Ç§„ÉñÈÖç‰ø°„ÇíÈñãÂßã
                </h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            ÈÖç‰ø°ËÄÖÂêç
                        </label>
                        <input 
                            type="text" 
                            id="hostNameInput"
                            value="${AppState.hostName}"
                            placeholder="„ÅÇ„Å™„Åü„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            ÈÖç‰ø°„Çø„Ç§„Éà„É´Ôºà‰ªªÊÑèÔºâ
                        </label>
                        <input 
                            type="text" 
                            id="roomTitleInput"
                            value="${AppState.roomTitle}"
                            placeholder="ÈÖç‰ø°„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                        >
                    </div>
                    
                    <div class="bg-coffee-50 dark:bg-coffee-900 p-3 rounded-md">
                        <p class="text-sm text-coffee-700 dark:text-coffee-300">
                            üí° ÈÖç‰ø°„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅ‰ªñ„ÅÆ‰∫∫„Åå„ÅÇ„Å™„Åü„ÅÆÈü≥Â£∞„ÇíËÅû„Åè„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
                        </p>
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button 
                        onclick="cancelStreamingForm()"
                        class="flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                    <button 
                        onclick="handleStartStreaming()"
                        class="flex-1 px-4 py-2 bg-coffee-500 text-white rounded-md hover:bg-coffee-600 transition-colors"
                    >
                        ÈÖç‰ø°ÈñãÂßã
                    </button>
                </div>
            </div>
        </div>
    `;
}

// „É´„Éº„É†ÂèÇÂä†„Éï„Ç©„Éº„É†
function renderJoinForm() {
    return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
                    ÈÖç‰ø°„Å´ÂèÇÂä†
                </h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            „ÅÇ„Å™„Åü„ÅÆÂêçÂâç
                        </label>
                        <input 
                            type="text" 
                            id="listenerNameInput"
                            value="${AppState.listenerName}"
                            placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            „É´„Éº„É†URL
                        </label>
                        <input 
                            type="url" 
                            id="roomUrlInput"
                            value="${AppState.roomUrl}"
                            placeholder="https://manus-test.daily.co/room-name"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-coffee-500 dark:bg-gray-700 dark:text-white"
                        >
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-md">
                        <p class="text-sm text-blue-700 dark:text-blue-300">
                            üéß „É™„Çπ„Éä„Éº„Å®„Åó„Å¶ÂèÇÂä†„Åó„Åæ„Åô„ÄÇÈü≥Â£∞„ÅØÈÄÅ‰ø°„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
                        </p>
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button 
                        onclick="cancelJoinForm()"
                        class="flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                    <button 
                        onclick="handleJoinRoom()"
                        class="flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"
                    >
                        ÂèÇÂä†
                    </button>
                </div>
            </div>
        </div>
    `;
}

// ÈÖç‰ø°‰∏≠„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
function renderStreamingInterface() {
    const roomInfo = getRoomDisplayInfo();
    if (!roomInfo) return '';
    
    return `
        <div class="bg-gradient-to-r from-red-500 to-pink-500 text-white p-4 rounded-lg mb-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-white rounded-full recording-pulse"></div>
                    <span class="font-semibold">LIVEÈÖç‰ø°‰∏≠</span>
                </div>
                <div class="text-sm opacity-90">
                    ${roomInfo.duration}
                </div>
            </div>
            
            <h3 class="font-semibold text-lg mb-2">${roomInfo.title}</h3>
            <p class="text-sm opacity-90 mb-3">ÈÖç‰ø°ËÄÖ: ${roomInfo.host}</p>
            
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-1">
                        <span class="text-sm">üë•</span>
                        <span class="text-sm">${roomInfo.participantCount}‰∫∫</span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2">
                    <button 
                        onclick="toggleStreamingAudio()"
                        class="p-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors"
                    >
                        ${Icons.Mic}
                    </button>
                    <button 
                        onclick="shareCurrentRoom()"
                        class="p-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors"
                    >
                        üì§
                    </button>
                    <button 
                        onclick="handleStopStreaming()"
                        class="px-4 py-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors text-sm"
                    >
                        ÈÖç‰ø°ÁµÇ‰∫Ü
                    </button>
                </div>
            </div>
        </div>
    `;
}

// „É™„Çπ„Éã„É≥„Ç∞‰∏≠„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
function renderListeningInterface() {
    const roomInfo = getRoomDisplayInfo();
    if (!roomInfo) return '';
    
    return `
        <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg mb-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-white rounded-full recording-pulse"></div>
                    <span class="font-semibold">ÈÖç‰ø°„ÇíËÅ¥Âèñ‰∏≠</span>
                </div>
                <div class="text-sm opacity-90">
                    ${roomInfo.duration}
                </div>
            </div>
            
            <h3 class="font-semibold text-lg mb-2">${roomInfo.title}</h3>
            <p class="text-sm opacity-90 mb-3">ÈÖç‰ø°ËÄÖ: ${roomInfo.host}</p>
            
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-1">
                        <span class="text-sm">üë•</span>
                        <span class="text-sm">${roomInfo.participantCount}‰∫∫</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="text-sm">üéß</span>
                        <span class="text-sm">„É™„Çπ„Éä„Éº</span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2">
                    <button 
                        onclick="shareCurrentRoom()"
                        class="p-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors"
                    >
                        üì§
                    </button>
                    <button 
                        onclick="handleLeaveRoom()"
                        class="px-4 py-2 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-colors text-sm"
                    >
                        ÈÄÄÂá∫
                    </button>
                </div>
            </div>
        </div>
    `;
}

// ÈÖç‰ø°„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥
function renderStreamingControls() {
    if (AppState.isStreaming || AppState.isListening) {
        return ''; // ÈÖç‰ø°‰∏≠/ËÅ¥Âèñ‰∏≠„ÅØË°®Á§∫„Åó„Å™„ÅÑ
    }
    
    return `
        <div class="grid grid-cols-2 gap-3 mb-6">
            <button 
                onclick="showStreamingForm()"
                class="flex flex-col items-center justify-center p-4 bg-gradient-to-r from-coffee-500 to-coffee-600 text-white rounded-lg hover:from-coffee-600 hover:to-coffee-700 transition-all transform hover:scale-105"
            >
                <div class="w-8 h-8 mb-2">
                    ${Icons.Mic}
                </div>
                <span class="text-sm font-medium">ÈÖç‰ø°ÈñãÂßã</span>
            </button>
            
            <button 
                onclick="showJoinForm()"
                class="flex flex-col items-center justify-center p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105"
            >
                <div class="w-8 h-8 mb-2">
                    üéß
                </div>
                <span class="text-sm font-medium">ÈÖç‰ø°„Å´ÂèÇÂä†</span>
            </button>
        </div>
    `;
}

// „Ç®„É©„ÉºË°®Á§∫
function renderStreamingError() {
    if (!AppState.streamingError) return '';
    
    return `
        <div class="bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4 mb-4">
            <div class="flex items-center">
                <div class="text-red-500 mr-3">‚ö†Ô∏è</div>
                <div>
                    <h4 class="text-red-800 dark:text-red-200 font-medium">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</h4>
                    <p class="text-red-600 dark:text-red-300 text-sm mt-1">${AppState.streamingError}</p>
                </div>
            </div>
        </div>
    `;
}

// „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÉºÈñ¢Êï∞
function showStreamingForm() {
    AppState.showRoomForm = true;
    renderApp();
}

function cancelStreamingForm() {
    AppState.showRoomForm = false;
    renderApp();
}

function showJoinForm() {
    AppState.showJoinForm = true;
    renderApp();
}

function cancelJoinForm() {
    AppState.showJoinForm = false;
    renderApp();
}

async function handleStartStreaming() {
    const hostName = document.getElementById('hostNameInput').value.trim();
    const roomTitle = document.getElementById('roomTitleInput').value.trim();
    
    if (!hostName) {
        alert('ÈÖç‰ø°ËÄÖÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    AppState.hostName = hostName;
    AppState.roomTitle = roomTitle;
    AppState.showRoomForm = false;
    
    const result = await startStreaming(hostName, roomTitle);
    
    if (result.success) {
        console.log('ÈÖç‰ø°ÈñãÂßãÊàêÂäü:', result);
    } else {
        console.error('ÈÖç‰ø°ÈñãÂßãÂ§±Êïó:', result.error);
    }
}

async function handleJoinRoom() {
    const listenerName = document.getElementById('listenerNameInput').value.trim();
    const roomUrl = document.getElementById('roomUrlInput').value.trim();
    
    if (!listenerName) {
        alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    if (!roomUrl || !validateRoomUrl(roomUrl)) {
        alert('ÊúâÂäπ„Å™„É´„Éº„É†URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    AppState.listenerName = listenerName;
    AppState.roomUrl = roomUrl;
    AppState.showJoinForm = false;
    
    const result = await joinRoom(roomUrl, listenerName);
    
    if (result.success) {
        console.log('„É´„Éº„É†ÂèÇÂä†ÊàêÂäü:', result);
    } else {
        console.error('„É´„Éº„É†ÂèÇÂä†Â§±Êïó:', result.error);
    }
}

async function handleStopStreaming() {
    if (confirm('ÈÖç‰ø°„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü')) {
        await stopStreaming();
    }
}

async function handleLeaveRoom() {
    if (confirm('ÈÖç‰ø°„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åô„ÅãÔºü')) {
        await leaveRoom();
    }
}

function shareCurrentRoom() {
    if (AppState.roomUrl) {
        shareRoomUrl(AppState.roomUrl);
    }
}

// „Çø„ÉñÂàá„ÇäÊõø„ÅàÊôÇ„ÅÆÈÖç‰ø°„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„ÇπÁµ±Âêà
function renderStreamingTab() {
    return `
        <div class="p-4">
            ${renderStreamingError()}
            ${renderStreamingInterface()}
            ${renderListeningInterface()}
            ${renderStreamingControls()}
            
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                    „É©„Ç§„ÉñÈÖç‰ø°„Å´„Å§„ÅÑ„Å¶
                </h3>
                
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">ÈÖç‰ø°ËÄÖ„Å®„Åó„Å¶</h4>
                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                        <li>‚Ä¢ „É™„Ç¢„É´„Çø„Ç§„É†„ÅßÈü≥Â£∞„ÇíÈÖç‰ø°„Åß„Åç„Åæ„Åô</li>
                        <li>‚Ä¢ ÂèÇÂä†ËÄÖÊï∞„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô</li>
                        <li>‚Ä¢ „É´„Éº„É†URL„ÇíÂÖ±Êúâ„Åó„Å¶ËÅ¥ÂèñËÄÖ„ÇíÊãõÂæÖ„Åß„Åç„Åæ„Åô</li>
                    </ul>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">„É™„Çπ„Éä„Éº„Å®„Åó„Å¶</h4>
                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                        <li>‚Ä¢ „É´„Éº„É†URL„ÅßÈÖç‰ø°„Å´ÂèÇÂä†„Åß„Åç„Åæ„Åô</li>
                        <li>‚Ä¢ È´òÂìÅË≥™„Å™Èü≥Â£∞„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßËÅ¥Âèñ„Åß„Åç„Åæ„Åô</li>
                        <li>‚Ä¢ ‰ªñ„ÅÆÂèÇÂä†ËÄÖ„Å®‰∏ÄÁ∑í„Å´ÈÖç‰ø°„ÇíÊ•Ω„Åó„ÇÅ„Åæ„Åô</li>
                    </ul>
                </div>
            </div>
        </div>
    `;
}

